<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amazon Slug Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .main-content {
            padding: 2rem;
        }

        .input-section {
            margin-bottom: 2rem;
        }

        .input-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }

        input[type="text"], textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 120px;
            font-family: 'Courier New', monospace;
        }

        .generate-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 14px 32px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            width: 100%;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .generate-btn:active {
            transform: translateY(0);
        }

        .generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .results-section {
            margin-top: 2rem;
            display: none;
        }

        .product-info {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }

        .product-info h3 {
            color: #333;
            margin-bottom: 0.5rem;
        }

        .product-info p {
            color: #666;
            line-height: 1.5;
        }

        .slugs-container {
            display: grid;
            gap: 1rem;
        }

        .slug-item {
            background: white;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            padding: 1rem;
            transition: all 0.3s ease;
        }

        .slug-item:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .slug-link {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            font-size: 1.1rem;
            display: block;
            margin-bottom: 0.5rem;
        }

        .slug-link:hover {
            color: #764ba2;
        }

        .slug-description {
            color: #666;
            font-size: 0.9rem;
        }

        .loading {
            text-align: center;
            padding: 2rem;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .domain-input {
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõçÔ∏è Amazon Slug Generator</h1>
            <p>Generate SEO-friendly category slugs from Amazon product ASINs</p>
        </div>
        
        <div class="main-content">
            <div class="input-section">
                <div class="input-group domain-input">
                    <label for="domain">Your Domain</label>
                    <input type="text" id="domain" placeholder="example.com" value="yoursite.com">
                </div>
                
                <div class="input-group">
                    <label for="asin">Amazon ASIN</label>
                    <input type="text" id="asin" placeholder="B08N5WRWNW" maxlength="10">
                </div>
                
                <div class="input-group">
                    <label for="prompt">AI Prompt Template</label>
                    <textarea id="prompt" placeholder="Enter your custom prompt for generating slugs...">Based on product title and description, return 5 concise category slugs (one per line) this product can be highlighted on as the #1 product of a top 10 list. These slugs should reflect what users would search for and fit for, should be very concise, can also use use cases or variants of the product. the format of "10 Best {slug} ‚Äì 2025". Return only clean slug names, no numbers, no full titles. Avoid general categories like mens-accessories or women-shoes.

Product: {product_name}
Description: {product_description}

Example format:
hair-clippers
barber-tools
grooming-kits
cordless-trimmers
mens-accessories</textarea>
                </div>
                
                <button class="generate-btn" onclick="generateSlugs()">
                    Generate Slugs
                </button>
            </div>
            
            <div class="results-section" id="results">
                <div class="loading" id="loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Fetching product data and generating slugs...</p>
                </div>
                
                <div class="product-info" id="productInfo" style="display: none;">
                    <h3>Product Information</h3>
                    <p id="productDetails"></p>
                </div>
                
                <div class="slugs-container" id="slugsContainer">
                </div>
            </div>
        </div>
    </div>

    <!-- Load config if available -->
    <script src="config.js" onerror="console.log('Config file not found - using defaults')"></script>
    
    <script>
        // Test if JavaScript is working
        console.log('JavaScript loaded successfully');
        
        // OpenAI API key - set via config.js or environment
        window.OPENAI_API_KEY = window.OPENAI_API_KEY || 'YOUR_OPENAI_API_KEY_HERE';
        
        // Debug API availability
        console.log('Checking API configuration...');
        console.log('RapidAPI configured:', 'dc9404ca72mshf17df4e79b9ae01p167dc2jsnea3edd65fd3e' ? 'Yes' : 'No');
        console.log('OpenAI configured:', window.OPENAI_API_KEY !== 'YOUR_OPENAI_API_KEY_HERE' ? 'Yes' : 'No');
        
        async function generateSlugs() {
            const asin = document.getElementById('asin').value.trim();
            const domain = document.getElementById('domain').value.trim();
            const prompt = document.getElementById('prompt').value.trim();
            
            if (!asin || !domain || !prompt) {
                alert('Please fill in all fields');
                return;
            }
            
            if (asin.length !== 10) {
                alert('ASIN should be exactly 10 characters');
                return;
            }
            
            // Show loading
            document.getElementById('results').style.display = 'block';
            document.getElementById('loading').style.display = 'block';
            document.getElementById('productInfo').style.display = 'none';
            document.getElementById('slugsContainer').innerHTML = '';
            
            try {
                // Simulate API calls for now - we'll replace with real APIs later
                await simulateProductFetch(asin, domain, prompt);
            } catch (error) {
                alert('Error generating slugs: ' + error.message);
                document.getElementById('loading').style.display = 'none';
            }
        }
        
        async function simulateProductFetch(asin, domain, prompt) {
            try {
                // Try Real Time Amazon Data API
                console.log('Trying to fetch ASIN:', asin);
                const response = await fetch(`https://real-time-amazon-data.p.rapidapi.com/product-details?asin=${asin}&country=US`, {
                    method: 'GET',
                    headers: {
                        'x-rapidapi-key': 'dc9404ca72mshf17df4e79b9ae01p167dc2jsnea3edd65fd3e',
                        'x-rapidapi-host': 'real-time-amazon-data.p.rapidapi.com'
                    }
                });

                console.log('Response status:', response.status);
                
                if (response.ok) {
                    const productData = await response.json();
                    console.log('Full API response:', JSON.stringify(productData, null, 2));
                    console.log('Available fields:', Object.keys(productData));
                    
                    // Check if we have valid product data
                    if (productData && (productData.product_title || productData.title || productData.name || productData.data)) {
                        // Handle different response structures
                        let product;
                        if (productData.data) {
                            product = productData.data; // If data is wrapped
                        } else {
                            product = productData; // If data is direct
                        }
                        
                        console.log('Product object fields:', Object.keys(product));
                        console.log('Raw product_description:', JSON.stringify(product.product_description, null, 2));
                        console.log('Raw about_product:', JSON.stringify(product.about_product, null, 2));

                        // Use real Amazon data with improved description extraction
                        const productInfo = {
                            name: product.product_title || product.title || product.name || 'Product Title Not Available',
                            description: product.product_description || 
                                        product.description || 
                                        product.about || 
                                        (product.about_product && Array.isArray(product.about_product) ? product.about_product.join('. ') : product.about_product) ||
                                        (product.features && Array.isArray(product.features) ? product.features.join('. ') : product.features) ||
                                        (product.bullet_points && Array.isArray(product.bullet_points) ? product.bullet_points.join('. ') : product.bullet_points) ||
                                        (product.highlights && Array.isArray(product.highlights) ? product.highlights.join('. ') : product.highlights) ||
                                        'Description not available'
                        };
                        
                        console.log('Processed product:', productInfo);
                        
                        // Generate slugs using AI
                        const slugs = await generateAISlugs(productInfo.name, productInfo.description, prompt);
                        
                        // Hide loading
                        document.getElementById('loading').style.display = 'none';
                        
                        // Show product info
                        document.getElementById('productInfo').style.display = 'block';
                        document.getElementById('productDetails').innerHTML = `
                            <strong>${productInfo.name}</strong><br>
                            <span style="color: #666;">${productInfo.description}</span>
                            <div style="margin-top: 0.5rem; font-size: 0.8rem; color: #00d084;">‚úÖ Live Amazon data via RapidAPI</div>
                        `;
                        
                        // Display slugs
                        displaySlugs(slugs, domain);
                        return;
                    } else {
                        console.log('API returned data but no product info found');
                    }
                } else {
                    console.log('RapidAPI error:', response.status, await response.text());
                }
            } catch (error) {
                console.log('RapidAPI failed:', error.message);
            }
            
            // Enhanced fallback with more realistic product data simulation
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            // Enhanced mock product database with more ASINs
            const mockProducts = {
                'B08N5WRWNW': {
                    name: 'Apple iPhone 12 Pro Clear Case with MagSafe',
                    description: 'Perfectly aligned magnets make wireless charging faster and easier than ever before. The clear design shows off the beautiful finish of your iPhone while providing excellent protection.'
                },
                'B07FZ8S74R': {
                    name: 'Echo Dot (3rd Gen) - Smart speaker with Alexa - Charcoal',
                    description: 'Our most popular smart speaker with a fabric design. It is our most compact smart speaker that fits perfectly into small spaces. Voice control your music, get news, weather, and more.'
                },
                'B08C1W5N87': {
                    name: 'Echo Dot (4th Gen) | Smart speaker with Alexa | Charcoal', 
                    description: 'Meet the all-new Echo Dot - Our most popular smart speaker with Alexa. The sleek, compact design delivers crisp vocals and balanced bass for full sound.'
                },
                'B0BDHT1YYF': {
                    name: 'Apple AirPods Pro (2nd Generation)',
                    description: 'Up to 2x more Active Noise Cancellation than the previous AirPods Pro. Adaptive Transparency lets outside sounds in while reducing loud environmental noise.'
                },
                'B09JQMJHXY': {
                    name: 'Apple Watch Series 8 GPS 45mm Midnight Aluminum Case',
                    description: 'Temperature sensing provides insights into womens health. Crash Detection can automatically connect you with emergency services. Advanced health sensors monitor your blood oxygen and heart rhythm.'
                },
                'B0963152JN': {
                    name: 'Novah¬Æ Professional Hair Clippers for Men, Professional Barber Clippers and Trimmer Set',
                    description: 'PRO TESTED, CREATED FOR ALL - Our Novah barber kit has been tested in some of the best barbershops around the world. Features premium guards, adjustable head, and industry leading design.'
                }
            };
            
            const product = mockProducts[asin] || {
                name: `Product ${asin}`,
                description: 'High-quality consumer electronics product available on Amazon. Features modern design and reliable performance for everyday use.'
            };
            
            // Generate enhanced slugs
            const slugs = await generateAISlugs(product.name, product.description, prompt);
            
            // Hide loading
            document.getElementById('loading').style.display = 'none';
            
            // Show product info
            document.getElementById('productInfo').style.display = 'block';
            document.getElementById('productDetails').innerHTML = `
                <strong>${product.name}</strong><br>
                <span style="color: #666;">${product.description}</span>
                <div style="margin-top: 0.5rem; font-size: 0.8rem; color: #ff9500;">‚ö° Demo mode - using enhanced mock data</div>
            `;
            
            // Display slugs
            displaySlugs(slugs, domain);
        }
        
        async function generateAISlugs(productName, description, prompt) {
            // Replace placeholders in prompt
            const filledPrompt = prompt
                .replace('{product_name}', productName)
                .replace('{product_description}', description);
            
            console.log('Filled prompt for AI:', filledPrompt);
            
            try {
                // Try OpenAI API first
                const openaiResponse = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + (window.OPENAI_API_KEY || 'YOUR_OPENAI_API_KEY')
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [
                            {
                                role: 'user',
                                content: filledPrompt
                            }
                        ],
                        max_tokens: 100,
                        temperature: 0.7
                    })
                });

                if (openaiResponse.ok) {
                    const data = await openaiResponse.json();
                    const aiResponse = data.choices[0].message.content.trim();
                    console.log('OpenAI response:', aiResponse);
                    
                    // Parse the AI response - handle multiple formats
                    let slugs = [];
                    try {
                        // First try JSON parsing
                        const jsonResponse = JSON.parse(aiResponse);
                        if (jsonResponse.slugs && Array.isArray(jsonResponse.slugs)) {
                            slugs = jsonResponse.slugs;
                        } else if (Array.isArray(jsonResponse)) {
                            slugs = jsonResponse;
                        }
                    } catch (parseError) {
                        console.log('Not JSON, trying other formats');
                        
                        // Try numbered list format (1. slug 2. slug)
                        if (aiResponse.match(/\d+\.?\s*[a-zA-Z]/)) {
                            slugs = aiResponse
                                .split(/\d+\.?\s*/)
                                .filter(item => item.trim().length > 0)
                                .map(item => item.trim());
                        }
                        // Try newline separated
                        else if (aiResponse.includes('\n')) {
                            slugs = aiResponse
                                .split('\n')
                                .filter(item => item.trim().length > 0)
                                .map(item => item.trim().replace(/^\d+\.?\s*/, ''));
                        }
                        // Try comma separated
                        else if (aiResponse.includes(',')) {
                            slugs = aiResponse
                                .split(',')
                                .filter(item => item.trim().length > 0)
                                .map(item => item.trim());
                        }
                        // Single response - split into words as fallback
                        else {
                            slugs = [aiResponse.trim()];
                        }
                    }
                    
                    // Clean and format slugs
                    slugs = slugs
                        .map(slug => slug.toLowerCase()
                            .replace(/^\d+\.?\s*/, '') // Remove leading numbers
                            .replace(/[^a-z0-9\s-]/g, '') // Remove special chars except spaces and hyphens
                            .replace(/\s+/g, '-') // Convert spaces to hyphens
                            .replace(/-+/g, '-') // Remove duplicate hyphens
                            .replace(/^-|-$/g, '') // Remove leading/trailing hyphens
                        )
                        .filter(slug => slug.length > 2); // Filter out very short slugs
                    
                    slugs = slugs.slice(0, 5); // Limit to 5 as requested in prompt
                    
                    if (slugs.length > 0) {
                        console.log('AI generated slugs:', slugs);
                        return slugs;
                    }
                }
            } catch (error) {
                console.log('OpenAI API failed:', error.message);
            }
            
            // Fallback to smart keyword-based generation if AI fails
            console.log('Using fallback slug generation');
            const words = productName.toLowerCase().split(' ');
            const slugs = [];
            
            // Enhanced smart slug generation based on product name analysis
            if (words.some(word => ['clipper', 'trimmer', 'barber', 'hair', 'grooming'].includes(word))) {
                slugs.push('hair-clippers', 'barber-tools', 'grooming-equipment', 'hair-trimmer', 'mens-grooming');
            } else if (words.some(word => ['iphone', 'phone', 'mobile', 'smartphone'].includes(word))) {
                slugs.push('phone-accessories', 'mobile-cases', 'smartphone-protection', 'iphone-gear', 'wireless-charging');
            } else if (words.some(word => ['echo', 'alexa', 'speaker', 'smart'].includes(word))) {
                slugs.push('smart-speakers', 'home-automation', 'voice-assistants', 'amazon-devices', 'connected-home');
            } else if (words.some(word => ['laptop', 'computer', 'pc', 'desktop'].includes(word))) {
                slugs.push('computer-accessories', 'laptop-gear', 'tech-peripherals', 'computing-devices', 'office-electronics');
            } else if (words.some(word => ['watch', 'fitness', 'tracker', 'wearable'].includes(word))) {
                slugs.push('wearable-tech', 'fitness-trackers', 'smartwatches', 'health-devices', 'activity-monitors');
            } else {
                // Generic categories
                slugs.push('electronics', 'accessories', 'gadgets', 'tech-products', 'consumer-goods');
            }
            
            return slugs.slice(0, 5);
        }
        
        function generateMockSlugs(productName, description) {
            // Simple mock slug generation based on product name
            const words = productName.toLowerCase().split(' ');
            const slugs = [];
            
            // Generate different category combinations
            if (words.includes('iphone') || words.includes('phone')) {
                slugs.push('phone-accessories', 'mobile-cases', 'smartphone-gear', 'iphone-cases', 'tech-accessories');
            } else if (words.includes('echo') || words.includes('alexa')) {
                slugs.push('smart-speakers', 'home-automation', 'voice-assistants', 'amazon-devices', 'smart-home');
            } else {
                slugs.push('electronics', 'accessories', 'gadgets', 'tech-products', 'consumer-electronics');
            }
            
            return slugs.slice(0, 5);
        }
        
        function displaySlugs(slugs, domain) {
            const container = document.getElementById('slugsContainer');
            container.innerHTML = '';
            
            slugs.forEach((slug, index) => {
                const slugItem = document.createElement('div');
                slugItem.className = 'slug-item';
                slugItem.style.animationDelay = `${index * 0.1}s`;
                
                const fullUrl = `https://${domain}/${slug}/`;
                
                slugItem.innerHTML = `
                    <a href="${fullUrl}" target="_blank" class="slug-link">${fullUrl}</a>
                    <div class="slug-description">Category: ${slug.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</div>
                `;
                
                container.appendChild(slugItem);
            });
        }
        
        // Allow Enter key to trigger generation
        document.getElementById('asin').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                generateSlugs();
            }
        });
    </script>
</body>
</html>